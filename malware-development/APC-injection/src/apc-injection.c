#include <windows.h>
#include <stdio.h>

VOID CALLBACK ApcPayload(ULONG_PTR dwParam) {
    MessageBoxW(
        NULL,
        L"APC Injection Executed Successfully",
        L"APC Demo",
        MB_OK | MB_ICONINFORMATION
    );
}

DWORD WINAPI AlertableThread(LPVOID lpParam) {
    SleepEx(INFINITE, TRUE); // Alertable state
    return 0;
}

int main(void) {
    HANDLE hThread = CreateThread(
        NULL,
        0,
        AlertableThread,
        NULL,
        0,
        NULL
    );

    if (!hThread) {
        printf("CreateThread failed\n");
        return 1;
    }

    QueueUserAPC(
        (PAPCFUNC)ApcPayload,
        hThread,
        NULL
    );

    WaitForSingleObject(hThread, INFINITE);
    CloseHandle(hThread);
    return 0;
}
