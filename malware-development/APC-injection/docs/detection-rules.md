# Detection Rules

## What is YARA?
YARA is a pattern-matching tool for identifying malware based on code signatures and behaviors.

## Quick Usage
```bash
# Install YARA, then:
yara rule.yar file-to-scan.exe
```

## YARA Rules

### Rule : APC_Injection_Technique
```yara
rule APC_Injection_Technique {
    meta:
        author = "NIZAR ADERBAZ"
        description = "Detects Asynchronous Procedure Call (APC) injection patterns"
        date = "2025"
        severity = "High"
    
    strings:
        $queue_apc = "QueueUserAPC" wide ascii
        $sleep_ex = "SleepEx" wide ascii
        $create_thread = "CreateThread" wide ascii
        $virtual_alloc = "VirtualAlloc" wide ascii
        $virtual_protect = "VirtualProtect" wide ascii
        $page_execute = "PAGE_EXECUTE_READWRITE" wide ascii

    condition:
        (filesize < 100KB) and 
        (uint16(0) == 0x5A4D) and
        (4 of ($queue_apc, $sleep_ex, $create_thread, $virtual_alloc, $virtual_protect))
}
```

---

### Rule : APC_Injection_Alertable_State
```yara
rule APC_Injection_Alertable_State {
    meta:
        author = "NIZAR ADERBAZ"
        description = "Detects APC injection with alertable thread state patterns"
        date = "2025"
        severity = "Medium"
    
    strings:
        $sleep_ex = "SleepEx" wide ascii
        $wait_single = "WaitForSingleObjectEx" wide ascii
        $wait_multiple = "WaitForMultipleObjectsEx" wide ascii
        $inf_constant = "INFINITE" wide ascii
        $true_constant = "TRUE" wide ascii
        $alertable = "AlertableThread" wide ascii

    condition:
        (filesize < 100KB) and 
        (uint16(0) == 0x5A4D) and
        (
            (all of ($sleep_ex, $inf_constant, $true_constant)) or
            (3 of ($wait_single, $wait_multiple, $inf_constant, $true_constant))
        )
}
```

