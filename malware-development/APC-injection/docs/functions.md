# Functions Explanation

## ApcPayload()
**Purpose:**  
Defines the function that will be executed when the APC is delivered to the target thread.

**Key Operations:**
- Calls `MessageBoxW()` to display a message
- Serves as visible proof of APC execution

**Why this function is used:**
- Matches the required APC callback signature
- Uses a legitimate Windows API
- Avoids shellcode or dynamic memory execution

**Parameters:**
- `dwParam`: Optional APC parameter (unused in this demo)

---

## AlertableThread()
**Purpose:**  
Creates a thread that can receive and execute APCs.

**Key Operations:**
- `SleepEx(INFINITE, TRUE)` – Puts the thread into an alertable wait state

**Why this is required:**
- APCs are executed only when a thread is in an alertable state
- Without `SleepEx(..., TRUE)`, the APC would never run

---

## main()
**Purpose:**  
Controls the overall program flow and demonstrates APC queuing.

**Key Operations:**
- `CreateThread()` – Starts the alertable thread
- `QueueUserAPC()` – Queues the APC payload to the thread
- `WaitForSingleObject()` – Keeps the process alive
- `CloseHandle()` – Releases system resources

**Execution Flow:**
1. Create alertable thread
2. Queue APC payload
3. Thread enters alertable state
4. APC executes payload
5. Program exits cleanly

---

## Windows API Used

### Thread Management
- `CreateThread` – Creates a new execution thread
- `SleepEx` – Enables alertable state
- `WaitForSingleObject` – Synchronization
- `CloseHandle` – Resource cleanup

### APC Mechanism
- `QueueUserAPC` – Queues an APC to a specific thread

### User Interaction
- `MessageBoxW` – Displays benign output

---

## Summary
This function set demonstrates **APC execution mechanics** using:
- A controlled local thread
- Documented Windows APIs
- A harmless payload

The design focuses on **understanding APC behavior**, not exploitation, making it suitable for academic and defensive security projects.

