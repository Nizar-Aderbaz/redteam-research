# Technical Details

## Windows Registry API Functions Used

### RegCreateKeyExA()
- **Purpose**: Creates a new registry key or opens an existing one
- **In our code**: Creates `HKEY_CURRENT_USER\Software\MySafeDemo`
- **Parameters**: 
  - `HKEY_CURRENT_USER` - Current user's registry section
  - `"Software\\MySafeDemo"` - Our safe demonstration key
  - `KEY_WRITE` - Permission to write to this key

### RegSetValueExA()
- **Purpose**: Stores data in a registry value
- **In our code**: Saves our binary data under the name "nizar"
- **Parameters**:
  - `REG_BINARY` - Type of data (raw binary)
  - `pShellcode` - Pointer to our data
  - `sShellcode` - Size of our data

### RegOpenKeyExA()
- **Purpose**: Opens an existing registry key
- **In our code**: Opens our previously created key for reading
- **Parameters**:
  - `KEY_READ` - Permission to only read from this key

### RegQueryValueExA()
- **Purpose**: Reads data from a registry value
- **In our code**: Used twice:
  1. First call: Gets the size of stored data (with NULL buffer)
  2. Second call: Reads the actual data into allocated memory

## Memory Management

### HeapAlloc()
- **Purpose**: Allocates memory from the heap
- **In our code**: Allocates exact space needed for retrieved registry data
- **Parameters**: `GetProcessHeap()` - Uses the current process's heap

### HeapFree()
- **Purpose**: Frees memory allocated by HeapAlloc
- **In our code**: Cleans up the memory after we're done using it

## Data Types and Structures

### Registry Data Type: REG_BINARY
- **What it is**: Raw binary data storage
- **Why used**: Perfect for storing any type of binary information
- **Alternative types**: REG_SZ (strings), REG_DWORD (numbers)

### PBYTE Pointer
- **What it is**: Pointer to BYTE (unsigned char) data
- **Usage**: Points to our binary data in memory

## Registry Structure Created
HKEY_CURRENT_USER
└── Software
 └── MySafeDemo (Our created key)
  └── nizar (Our value name)
   └── Binary Data (Our stored payload)

## Safety Mechanisms

### Error Handling
- Every registry function call checks return value
- Proper cleanup on failure (closing handles, freeing memory)
- Informative error messages for debugging

### Safe Data Display
- Hexadecimal printing prevents accidental execution
- String display only if null-terminated
- No execution capabilities in the display function

## Sample Data Details

```c
unsigned char shellcode[] = { 0x63,0x61,0x6c,0x63,0x2e,0x65,0x78,0x65,0x00 };
```

Hex to ASCII:

- `0x63,0x61,0x6c,0x63` = "calc"
- `0x2e` = "."
- `0x65,0x78,0x65` = "exe"
- `0x00` = null terminator

Result: `"calc.exe"` string in memory

## Compilation Requirements
- **Windows API:** Requires `Windows.h` header
- **Libraries:** Links against Windows system libraries automatically
- **Platform:** Windows only (uses Windows-specific APIs)
